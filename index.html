<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GRetail — TVs that vibe</title>

  <style>
    :root{
      --bg:#070712;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.09);
      --text:#eef0ff;
      --muted: rgba(238,240,255,.72);
      --stroke: rgba(255,255,255,.14);

      --neon1:#7C3AED;
      --neon2:#22D3EE;
      --neon3:#FB7185;

      --radius: 18px;
      --shadow: 0 18px 50px rgba(0,0,0,.55);
      --shadow2: 0 12px 34px rgba(0,0,0,.40);
      --max: 1180px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background:
        radial-gradient(900px 600px at 20% -10%, rgba(124,58,237,.35), transparent 60%),
        radial-gradient(900px 600px at 80% 10%, rgba(34,211,238,.25), transparent 60%),
        radial-gradient(900px 600px at 70% 120%, rgba(251,113,133,.20), transparent 60%),
        linear-gradient(180deg, #060614 0%, #070712 60%, #05050f 100%);
    }
    a{ color:inherit; text-decoration:none; }
    img{ max-width:100%; display:block; }
    button, input, select{ font: inherit; }
    .container{ width:min(var(--max), calc(100% - 32px)); margin:0 auto; }

    .nav{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(18px);
      background: rgba(7,7,18,.55);
      border-bottom: 1px solid var(--stroke);
    }
    .nav-inner{
      display:flex; align-items:center; justify-content:space-between;
      gap:16px; padding:14px 0;
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px; }
    .badge{
      font-size:12px; padding:4px 10px;
      border:1px solid var(--stroke); border-radius:999px;
      background: rgba(255,255,255,.06); color: var(--muted);
    }
    .logo-dot{
      width:12px; height:12px; border-radius:999px;
      background: linear-gradient(135deg, var(--neon1), var(--neon2), var(--neon3));
      box-shadow: 0 0 24px rgba(34,211,238,.35);
    }
    .nav-links{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end; }
    .nav-links a{
      padding:10px 12px; border:1px solid transparent; border-radius:999px;
      color: var(--muted);
    }
    .nav-links a:hover{ border-color: var(--stroke); background: rgba(255,255,255,.05); color: var(--text); }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border-radius:999px;
      border:1px solid var(--stroke); background: rgba(255,255,255,.06);
    }
    .count{
      display:inline-flex; min-width:22px; height:22px;
      align-items:center; justify-content:center;
      border-radius:999px; background: rgba(255,255,255,.12);
      border:1px solid var(--stroke); font-size:12px; padding:0 7px; color: var(--text);
    }

    .card{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
    }
    .card-pad{ padding:18px; }
    .glow{ position:relative; }
    .glow:before{
      content:""; position:absolute; inset:-2px;
      border-radius: calc(var(--radius) + 2px);
      background: linear-gradient(135deg, rgba(124,58,237,.55), rgba(34,211,238,.45), rgba(251,113,133,.55));
      filter: blur(18px); opacity:.7; z-index:-1;
    }

    .section{ padding: 14px 0 34px; }
    .section-title{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:12px; margin: 18px 0 12px;
    }
    .section-title h2{ margin:0; font-size:18px; letter-spacing:.2px; }
    .section-title .sub{ color: var(--muted); font-size:13px; }

    .hero{ padding:34px 0 14px; }
    .hero-grid{ display:grid; grid-template-columns: 1.25fr .75fr; gap:16px; }
    @media (max-width: 900px){ .hero-grid{ grid-template-columns:1fr; } }
    .hero h1{
      margin:0 0 10px;
      font-size: clamp(26px, 3.2vw, 44px);
      line-height:1.08; letter-spacing:-.6px;
    }
    .hero p{ margin:0 0 16px; color: var(--muted); max-width: 70ch; }
    .cta-row{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }

    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding:11px 14px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.22); }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      border-color: transparent;
      background: linear-gradient(135deg, rgba(124,58,237,.95), rgba(34,211,238,.85));
      box-shadow: 0 18px 38px rgba(124,58,237,.18);
    }
    .btn-primary:hover{ filter: brightness(1.05); }
    .btn-ghost{ background: transparent; }

    .kpis{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .kpi{
      padding:12px; border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.05);
    }
    .kpi b{ display:block; font-size:16px; }
    .kpi span{ color: var(--muted); font-size:13px; }

    .toolbar{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center; justify-content:space-between;
      padding: 14px;
    }
    .field{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .input, .select{
      background: rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      color: var(--text);
      border-radius: 12px;
      padding:10px 12px;
      outline:none;
      min-width: 200px;
    }
    .select{ min-width: 180px; }

    .grid{ display:grid; grid-template-columns: repeat(3, 1fr); gap:14px; }
    @media (max-width: 980px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 650px){ .grid{ grid-template-columns: 1fr; } }

    .product{ overflow:hidden; }
    .product .imgwrap{
      background: linear-gradient(135deg, rgba(124,58,237,.22), rgba(34,211,238,.16), rgba(251,113,133,.18));
      border-bottom: 1px solid var(--stroke);
      padding: 14px;
    }
    .product .imgwrap img{
      height: 180px; width: 100%;
      object-fit: contain;
      filter: drop-shadow(0 20px 34px rgba(0,0,0,.55));
    }
    .product .body{ padding: 14px; }
    .product h3{ margin: 0 0 6px; font-size: 16px; }
    .meta{ display:flex; justify-content:space-between; gap:10px; align-items:center; margin-bottom:8px; }
    .price{ font-weight: 900; letter-spacing:.2px; }
    .small{ font-size: 12px; color: var(--muted); }
    .tags{ display:flex; flex-wrap:wrap; gap:6px; margin: 10px 0 12px; }
    .tag{
      font-size:12px; padding:6px 10px;
      border-radius:999px; border:1px solid var(--stroke);
      background: rgba(255,255,255,.06); color: var(--muted);
    }
    .actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .iconbtn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius: 14px;
      border:1px solid var(--stroke); background: rgba(255,255,255,.06);
      cursor:pointer;
    }
    .iconbtn:hover{ background: rgba(255,255,255,.10); }
    .heart{ color: var(--muted); }
    .heart.on{ color: var(--neon3); }

    .table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: var(--radius);
      border:1px solid var(--stroke);
    }
    .table th, .table td{
      padding: 12px;
      border-bottom:1px solid rgba(255,255,255,.10);
      text-align:left; vertical-align: top;
    }
    .table th{
      color: var(--muted); font-weight:800;
      background: rgba(255,255,255,.04);
    }
    .table tr:last-child td{ border-bottom:none; }

    .split{ display:grid; grid-template-columns: 1.15fr .85fr; gap:14px; }
    @media (max-width: 900px){ .split{ grid-template-columns: 1fr; } }

    .summary{ padding: 14px; }
    .summary-row{
      display:flex; justify-content:space-between;
      padding: 10px 0;
      border-bottom:1px dashed rgba(255,255,255,.14);
      color: var(--muted);
    }
    .summary-row b{ color: var(--text); }
    .summary-row:last-child{ border-bottom:none; }

    .notice{
      padding: 12px 14px;
      border: 1px solid var(--stroke);
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      color: var(--muted);
    }
    hr.sep{ border:0; border-top:1px solid rgba(255,255,255,.12); margin:14px 0; }
    .footer{
      padding: 26px 0 34px;
      color: var(--muted);
      font-size: 13px;
      border-top: 1px solid rgba(255,255,255,.10);
      margin-top: 22px;
    }

    #toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      padding:12px 14px; border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      color:white; box-shadow: 0 18px 40px rgba(0,0,0,.45);
      z-index:999; opacity:0; transition: opacity .2s ease;
      pointer-events:none;
    }
  </style>

  <!-- ✅ Genesys Web Messaging bootstrap (APS1) -->
  <script type="text/javascript" charset="utf-8">
    (function (g, e, n, es, ys) {
      g['_genesysJs'] = e;
      g[e] = g[e] || function () { (g[e].q = g[e].q || []).push(arguments) };
      g[e].t = 1 * new Date();
      g[e].c = es;
      ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8';
      document.head.appendChild(ys);
    })(window, 'Genesys', 'https://apps.aps1.pure.cloud/genesys-bootstrap/genesys.min.js', {
      environment: 'prod-aps1',
      deploymentId: 'a7c8568b-d96d-4dab-9378-2a39d61e34ef'
      // debug: true
    });
  </script>

<!-- 2️⃣ Journey Web Tracking (ADD HERE) -->
<script>
  (function(a,t,c,l,o,u,d){a['_genesysJourneySdk']=o;a[o]=a[o]||function(){
  (a[o].q=a[o].q||[]).push(arguments)},a[o].l=1*new Date();u=t.createElement(c),
  d=t.getElementsByTagName(c)[0];u.async=1;u.src=l;u.charset='utf-8';d.parentNode.insertBefore(u,d)
  })(window, document, 'script', 'https://apps.aps1.pure.cloud/journey/sdk/js/web/v1/ac.js', 'ac');
  ac('init', 'a7c8568b-d96d-4dab-9378-2a39d61e34ef', { environment: 'prod-aps1' });
  ac('load', 'autotrackUrlChange');
</script>

  <script>
  // --- persistence key ---
  const MS_KEY = "gretail_messenger_open";

  // track ready state
  window.__messengerReady = false;

  // helper: check if we should auto-open
  function shouldAutoOpenMessenger() {
    try {
      return localStorage.getItem(MS_KEY) === "1";
    } catch (e) { return false; }
  }

  // helper: mark open state
  function markMessengerOpen() {
    try { localStorage.setItem(MS_KEY, "1"); } catch (e) {}
  }
  function markMessengerClosed() {
    try { localStorage.removeItem(MS_KEY); } catch (e) {}
  }

  // open messenger safely and remember that we opened it
  function openMessenger() {
    if (!window.__messengerReady) {
      console.log("Messenger not ready yet — will open once ready");
      // optional: set flag so it opens when ready
      markMessengerOpen();
      return;
    }
    Genesys("command", "Messenger.open", {}, function(){
      markMessengerOpen();
    }, function(err){
      console.error("Messenger.open failed", err);
    });
  }

  // close/clear messenger safely and forget open state
  function closeMessenger() {
    if (!window.__messengerReady) return;
    Genesys("command", "Messenger.close", {}, function(){
      markMessengerClosed();
    }, function(err){
      // Not all deployments expose "close" command; fallback to clear
      console.warn("Messenger.close failed, attempting clear", err);
      Genesys("command", "Messenger.clear", {}, function(){ markMessengerClosed(); }, function(e){ console.error("clear failed", e); });
    });
  }

  // Detect hard reload if you still want to clear on reloads (optional)
  function isHardReload() {
    try {
      const nav = performance.getEntriesByType("navigation")?.[0];
      if (nav && nav.type) return nav.type === "reload";
      return performance.navigation && performance.navigation.type === 1;
    } catch (e) { return false; }
  }

  // Subscribe to Messenger.ready once the SDK is queued/loaded
  // (the Genesys bootstrap pushes args to the queue; this will work once Genesys is available)
  try {
    Genesys("subscribe", "Messenger.ready", function () {
      console.log("Messenger.ready fired");
      window.__messengerReady = true;

      // If the stored state says it should be open, open it now
      if (shouldAutoOpenMessenger()) {
        Genesys("command", "Messenger.open", {}, function(){}, function(err){ console.error("open failed", err); });
      }

      // If you want to clear on hard reloads only, do it here:
      // if (isHardReload()) {
      //   Genesys("command", "Messenger.clear", {}, function(){ console.log("Cleared on hard reload"); }, function(e){ console.error(e); });
      // }
    });
  } catch (e) {
    // Genesys might not be loaded yet if this script runs before bootstrap script is inserted.
    // The bootstrap's queue will run subscribe once available; if you see errors, ensure the bootstrap snippet is before this one.
    console.error("Failed to subscribe to Messenger.ready — is the Genesys bootstrap present?", e);
  }

  // Optional: listen for a close/minimize event to clear the flag.
  // Not all deployments send the same events; try 'Messenger.closed' or 'Messenger.minimized' depending on your platform.
  try {
    Genesys("subscribe", "Messenger.closed", function () {
      console.log("Messenger.closed event received — clearing open flag");
      markMessengerClosed();
    });
  } catch (e) { /* ignore */ }

  // Expose functions globally (if your app uses them)
  window.openMessenger = openMessenger;
  window.closeMessenger = closeMessenger;
</script>


<body>
  <header class="nav">
    <div class="container nav-inner">
      <a class="brand" href="#/">
        <span class="logo-dot"></span>
        <span>GRetail</span>
        <span class="badge" id="routeBadge">TV Store</span>
      </a>
      <nav class="nav-links">
        <a href="#/products">Shop TVs</a>
        <a href="#/compare">Compare <span class="count" data-badge="compare">0</span></a>
        <a href="#/favorites">Favorites <span class="count" data-badge="favs">0</span></a>
        <a class="pill" href="#/cart">Cart <span class="count" data-badge="cart">0</span></a>
      </nav>
    </div>
  </header>

  <main class="container" id="app"></main>
  <div id="toast"></div>

  <script>
    // ========= Images =========
    const IMG = {
      FLAT_PANEL_PNG: "images/45inchtv.jpg",
      SAMSUNG_SMARTTV: "images/download65.jpg",
      SAMSUNG_E_SERIES: "images/download55n.jpg",
      LG_CURVED_OLED: "images/oled55.jpg",
      GENERIC_TV: "images/55-UHD-4k-low-price-online-kerala.jpg"
    };

    // ========= Catalog =========
    const CATALOG = [
      {
        id:"gr-aura-oled-55",
        name:"GRetail Aura OLED 55”",
        price: 89990,
        image: IMG.LG_CURVED_OLED,
        series:"Aura OLED",
        sizeIn:55, panel:"OLED", resolution:"4K UHD", refreshHz:120,
        hdr:"Dolby Vision + HDR10+",
        gaming:"VRR, ALLM, 2x HDMI 2.1",
        audio:"40W, Dolby Atmos",
        os:"GRetail SmartOS",
        warranty:"2 years",
        tags:["OLED blacks","120Hz gaming","Dolby Vision"]
      },
      {
        id:"gr-neon-qled-65",
        name:"GRetail Neon QLED 65”",
        price: 75990,
        image: IMG.SAMSUNG_SMARTTV,
        series:"Neon QLED",
        sizeIn:65, panel:"QLED", resolution:"4K UHD", refreshHz:120,
        hdr:"HDR10+",
        gaming:"VRR, ALLM, 4x HDMI",
        audio:"50W, Virtual Surround",
        os:"GRetail SmartOS",
        warranty:"2 years",
        tags:["Bright QLED","Big screen","Smooth 120Hz"]
      },
      {
        id:"gr-pulse-mini-led-75",
        name:"GRetail Pulse Mini-LED 75”",
        price: 129990,
        image: IMG.SAMSUNG_E_SERIES,
        series:"Pulse Mini-LED",
        sizeIn:75, panel:"Mini-LED", resolution:"4K UHD", refreshHz:144,
        hdr:"Dolby Vision IQ",
        gaming:"144Hz VRR, 2x HDMI 2.1",
        audio:"60W, Dolby Atmos",
        os:"GRetail SmartOS Pro",
        warranty:"3 years",
        tags:["Mini-LED contrast","144Hz","Cinematic HDR"]
      },
      {
        id:"gr-zen-led-43",
        name:"GRetail Zen LED 43”",
        price: 28990,
        image: IMG.FLAT_PANEL_PNG,
        series:"Zen LED",
        sizeIn:43, panel:"LED", resolution:"4K UHD", refreshHz:60,
        hdr:"HDR10",
        gaming:"ALLM",
        audio:"20W",
        os:"GRetail SmartOS Lite",
        warranty:"1 year",
        tags:["Budget 4K","Compact","Everyday smart"]
      },
      {
        id:"gr-vibe-qned-55",
        name:"GRetail Vibe QNED 55”",
        price: 62990,
        image: IMG.GENERIC_TV,
        series:"Vibe QNED",
        sizeIn:55, panel:"QNED", resolution:"4K UHD", refreshHz:120,
        hdr:"HDR10 Pro",
        gaming:"VRR, ALLM, 2x HDMI 2.1",
        audio:"40W",
        os:"GRetail SmartOS",
        warranty:"2 years",
        tags:["Punchy color","Fast motion","Great value"]
      }
    ];

    // ========= Storage =========
    const LS = {
      CART: "gretail_cart_v1",
      FAVS: "gretail_favs_v1",
      CMP:  "gretail_compare_v1",
      ORDER:"gretail_last_order_v1"
    };

    const loadJSON = (k, fb) => { try{ const r=localStorage.getItem(k); return r?JSON.parse(r):fb; }catch{ return fb; } };
    const saveJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));

    const findTV = (id) => CATALOG.find(x => x.id === id);
    const formatINR = (n) => "₹" + (n||0).toLocaleString("en-IN", { maximumFractionDigits: 0 });

    // ===================== CART =====================
    const getCart = () => loadJSON(LS.CART, {});  // { id: qty }

    const setCart = (c) => {
      saveJSON(LS.CART, c);
      updateBadges();
    };

    const addToCart = (id, qty = 1) => {
      const c = getCart();
      c[id] = (c[id] || 0) + qty;
      if (c[id] < 1) delete c[id];
      setCart(c);

      // Optional: open Messenger after add
      openMessenger();
    };

    const setQty = (id, qty) => {
      const c = getCart();
      if (!Number.isFinite(qty)) return;

      if (qty <= 0) delete c[id];
      else c[id] = qty;

      setCart(c);
    };

    const clearCart = () => setCart({});
    // ===================== END CART =====================

    // favorites
    const getFavs = () => loadJSON(LS.FAVS, []);
    const setFavs = (a) => { saveJSON(LS.FAVS,a); updateBadges(); };
    const toggleFav = (id) => {
      const s=new Set(getFavs());
      s.has(id)?s.delete(id):s.add(id);
      setFavs([...s]);
      return s.has(id);
    };

    // compare (max 3)
    const getCompare = () => loadJSON(LS.CMP, []);
    const setCompare = (a) => { saveJSON(LS.CMP,a); updateBadges(); };
    const toggleCompare = (id) => {
      const s=new Set(getCompare());
      if(s.has(id)) s.delete(id);
      else{
        if(s.size>=3){ alert("You can compare up to 3 TVs."); return false; }
        s.add(id);
      }
      setCompare([...s]);
      return s.has(id);
    };
    const clearCompare = () => setCompare([]);

    // totals
    function calcCartTotals(){
      const cart=getCart();
      let subtotal=0;
      const items=Object.entries(cart).map(([id,qty])=>{
        const tv=findTV(id); if(!tv) return null;
        const line=tv.price*qty; subtotal+=line;
        return {...tv, qty, line};
      }).filter(Boolean);

      const shipping = subtotal>60000 ? 0 : (items.length ? 799 : 0);
      const discount = subtotal>=120000 ? Math.round(subtotal*0.05) : 0;
      const total = Math.max(0, subtotal + shipping - discount);
      return {items, subtotal, shipping, discount, total};
    }

    // order
    const getLastOrder = () => loadJSON(LS.ORDER, null);
    function placeOrder(customer){
      const t=calcCartTotals();
      if(!t.items.length) return null;
      const now=new Date();
      const orderId="GR-"+String(now.getFullYear()).slice(-2)+String(now.getMonth()+1).padStart(2,"0")+String(now.getDate()).padStart(2,"0")+"-"+Math.random().toString(36).slice(2,7).toUpperCase();
      const txId="TXN-"+Math.random().toString(36).slice(2,11).toUpperCase();
      const order={
        orderId, txId,
        createdAt: now.toISOString(),
        customer,
        items: t.items.map(({id,name,price,qty,line,image})=>({id,name,price,qty,line,image})),
        subtotal:t.subtotal, shipping:t.shipping, discount:t.discount, total:t.total
      };
      saveJSON(LS.ORDER, order);
      clearCart();
      return order;
    }

    // toast
    let toastTimer=null;
    function toast(msg){
      const el=document.getElementById("toast");
      el.textContent=msg;
      el.style.opacity="1";
      clearTimeout(toastTimer);
      toastTimer=setTimeout(()=>el.style.opacity="0", 1600);
    }

    // badges
    function cartCounts(){
      const c=getCart();
      return { items: Object.values(c).reduce((a,b)=>a+b,0), unique: Object.keys(c).length };
    }
    function updateBadges(){
      const c=cartCounts();
      document.querySelectorAll("[data-badge='cart']").forEach(x=>x.textContent=c.items);
      document.querySelectorAll("[data-badge='favs']").forEach(x=>x.textContent=getFavs().length);
      document.querySelectorAll("[data-badge='compare']").forEach(x=>x.textContent=getCompare().length);
    }

    // ========= Views =========
    const app = document.getElementById("app");
    const badge = document.getElementById("routeBadge");

    function viewHome(){
      badge.textContent = "TV Store";
      app.innerHTML = `
        <section class="hero">
          <div class="hero-grid">
            <div class="card card-pad glow">
              <h1>Reimagine how you experience television.</h1>
              <p>
                At GRetail, we design and deliver cutting-edge Smart TVs that blend cinematic picture quality, immersive sound, and next-gen gaming performance — built for how you live today.
              </p>
              <div class="cta-row">
                <a class="btn btn-primary" href="#/products">Explore TVs</a>
                <a class="btn" href="#/compare">Compare models</a>
                <a class="btn btn-ghost" href="#/favorites">Find your perfect TV</a>
              </div>
              <hr class="sep">
              <div class="kpis">
                <div class="kpi"><b>Compare fast</b><span>Side-by-side specs like panel, HDR, refresh rate.</span></div>
                <div class="kpi"><b>Favorites</b><span>Shortlist so that you can come back & start over.</span></div>
              </div>
            </div>

            <div class="card card-pad">
              <div class="section-title">
                <h2>Quick actions</h2>
                <div class="sub">Jump right in</div>
              </div>
              <div class="cta-row">
                <a class="btn" href="#/products">Browse catalog</a>
                <a class="btn" href="#/cart">View cart</a>
                <a class="btn" href="#/checkout">Checkout</a>
              </div>
              <hr class="sep">
              <div class="notice">
                Everything is designed so that you get the best experience & it works with latest of technologies.
              </div>
            </div>
          </div>

          <div class="footer">
            <b>GRetail</b> Designed Internally for demo purposes.
          </div>
        </section>
      `;
    }

    function renderCatalogGrid({query="", sort="featured", panel="all", size="all"}){
      let list=[...CATALOG];
      const q=query.trim().toLowerCase();
      if(q){
        list=list.filter(x =>
          x.name.toLowerCase().includes(q) ||
          x.series.toLowerCase().includes(q) ||
          x.panel.toLowerCase().includes(q)
        );
      }
      if(panel!=="all") list=list.filter(x=>x.panel===panel);
      if(size!=="all"){
        const s=Number(size);
        if(!Number.isNaN(s)) list=list.filter(x=>x.sizeIn===s);
      }
      if(sort==="price-asc") list.sort((a,b)=>a.price-b.price);
      if(sort==="price-desc") list.sort((a,b)=>b.price-a.price);
      if(sort==="size-desc") list.sort((a,b)=>b.sizeIn-a.sizeIn);

      const favs=new Set(getFavs());
      const cmps=new Set(getCompare());

      return list.map(tv=>`
        <article class="card product">
          <div class="imgwrap">
            <img src="${tv.image}" alt="${tv.name}" loading="lazy">
          </div>
          <div class="body">
            <div class="meta">
              <div>
                <h3>${tv.name}</h3>
                <div class="small">${tv.panel} • ${tv.resolution} • ${tv.refreshHz}Hz</div>
              </div>
              <div class="price">${formatINR(tv.price)}</div>
            </div>

            <div class="tags">
              ${tv.tags.map(t=>`<span class="tag">${t}</span>`).join("")}
            </div>

            <div class="actions">
              <button class="btn btn-primary" data-add="${tv.id}">Add to cart</button>
              <button class="iconbtn" data-compare="${tv.id}">
                <span>Compare</span><span class="small">${cmps.has(tv.id)?"✓":"+"}</span>
              </button>
              <button class="iconbtn" data-fav="${tv.id}">
                <span class="heart ${favs.has(tv.id)?"on":""}">♥</span>
                <span>${favs.has(tv.id)?"Saved":"Favorite"}</span>
              </button>
            </div>
          </div>
        </article>
      `).join("");
    }

    function wireProductButtons(root){
      root.querySelectorAll("[data-add]").forEach(btn=>{
        btn.addEventListener("click", ()=>{ addToCart(btn.dataset.add,1); toast("Added to cart"); });
      });
      root.querySelectorAll("[data-fav]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const on=toggleFav(btn.dataset.fav);
          btn.querySelector(".heart").classList.toggle("on", on);
          btn.querySelector("span:nth-child(2)").textContent = on ? "Saved" : "Favorite";
          toast(on ? "Saved to favorites" : "Removed from favorites");
        });
      });
      root.querySelectorAll("[data-compare]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const on=toggleCompare(btn.dataset.compare);
          btn.querySelector(".small").textContent = on ? "✓" : "+";
          toast(on ? "Added to compare" : "Removed from compare");
        });
      });
    }

    function viewProducts(){
      badge.textContent = "Shop";
      app.innerHTML = `
        <section class="section">
          <div class="section-title">
            <h2>TVs for every mood</h2>
            <div class="sub">Search • Filter • Compare • Add to cart</div>
          </div>

          <div class="card toolbar">
            <div class="field">
              <input class="input" id="q" placeholder="Search: OLED, 65, Aura..."/>
              <select class="select" id="panel">
                <option value="all">All panels</option>
                <option>OLED</option><option>QLED</option><option>Mini-LED</option><option>LED</option><option>QNED</option>
              </select>
              <select class="select" id="size">
                <option value="all">All sizes</option>
                <option value="43">43"</option><option value="55">55"</option><option value="65">65"</option><option value="75">75"</option>
              </select>
            </div>
            <div class="field">
              <select class="select" id="sort">
                <option value="featured">Sort: Featured</option>
                <option value="price-asc">Price: Low → High</option>
                <option value="price-desc">Price: High → Low</option>
                <option value="size-desc">Size: Big → Small</option>
              </select>
              <a class="btn" href="#/compare">Go to compare</a>
            </div>
          </div>

          <div style="height:12px;"></div>
          <div class="grid" id="grid"></div>

          <div class="footer">
            Tip: Add up to <b>3</b> models to compare. Favorites are saved locally.
          </div>
        </section>
      `;

      const grid=document.getElementById("grid");
      const q=document.getElementById("q");
      const panel=document.getElementById("panel");
      const size=document.getElementById("size");
      const sort=document.getElementById("sort");

      function render(){
        grid.innerHTML = renderCatalogGrid({
          query:q.value, sort:sort.value, panel:panel.value, size:size.value
        });
        wireProductButtons(grid);
      }

      ["input","change"].forEach(evt=>{
        q.addEventListener(evt, render);
        panel.addEventListener(evt, render);
        size.addEventListener(evt, render);
        sort.addEventListener(evt, render);
      });

      render();
    }

    function viewFavorites(){
      badge.textContent = "Favorites";
      const favs=getFavs().map(findTV).filter(Boolean);

      app.innerHTML = `
        <section class="section">
          <div class="section-title">
            <h2>Your shortlist</h2>
            <div class="sub">Saved locally</div>
          </div>

          <div class="grid" id="favGrid">
            ${
              favs.length ? favs.map(tv=>`
                <div class="card product">
                  <div class="imgwrap"><img src="${tv.image}" alt="${tv.name}" loading="lazy"></div>
                  <div class="body">
                    <div class="meta">
                      <div>
                        <h3>${tv.name}</h3>
                        <div class="small">${tv.panel} • ${tv.sizeIn}” • ${tv.refreshHz}Hz</div>
                      </div>
                      <div class="price">${formatINR(tv.price)}</div>
                    </div>
                    <div class="actions">
                      <button class="btn btn-primary" data-add="${tv.id}">Add to cart</button>
                      <button class="btn" data-removefav="${tv.id}">Remove</button>
                      <button class="btn" data-compare="${tv.id}">Compare</button>
                    </div>
                  </div>
                </div>
              `).join("") : `<div class="notice">No favorites yet. Save TVs from the Shop page.</div>`
            }
          </div>

          <div class="footer">
            Favorite a TV on <a href="#/products"><b>Shop TVs</b></a> to keep it here.
          </div>
        </section>
      `;

      const root=app;
      root.querySelectorAll("[data-add]").forEach(b=>{
        b.addEventListener("click", ()=>{ addToCart(b.dataset.add,1); toast("Added to cart"); });
      });
      root.querySelectorAll("[data-removefav]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const id=b.dataset.removefav;
          const s=new Set(getFavs()); s.delete(id); setFavs([...s]);
          toast("Removed from favorites");
          location.hash="#/favorites";
        });
      });
      root.querySelectorAll("[data-compare]").forEach(b=>{
        b.addEventListener("click", ()=>{
          toggleCompare(b.dataset.compare);
          toast("Updated compare list");
        });
      });
    }

    function viewCompare(){
      badge.textContent = "Compare";
      const ids=getCompare();
      const list=ids.map(findTV).filter(Boolean);

      if(!list.length){
        app.innerHTML = `
          <section class="section">
            <div class="notice">Pick up to 3 TVs to compare from <a href="#/products"><b>Shop TVs</b></a>.</div>
            <div class="footer">Compare shows key specs side-by-side.</div>
          </section>
        `;
        return;
      }

      const rows = [
        ["Model", (tv)=> tv.name],
        ["Price", (tv)=> formatINR(tv.price)],
        ["Size", (tv)=> `${tv.sizeIn}”`],
        ["Panel", (tv)=> tv.panel],
        ["Resolution", (tv)=> tv.resolution],
        ["Refresh rate", (tv)=> `${tv.refreshHz}Hz`],
        ["HDR", (tv)=> tv.hdr],
        ["Gaming", (tv)=> tv.gaming],
        ["Audio", (tv)=> tv.audio],
        ["OS", (tv)=> tv.os],
        ["Warranty", (tv)=> tv.warranty]
      ];

      app.innerHTML = `
        <section class="section">
          <div class="card card-pad">
            <div class="section-title">
              <h2>Compare (${list.length})</h2>
              <div class="cta-row">
                <button class="btn" id="clearCompareBtn">Clear</button>
                <a class="btn btn-primary" href="#/products">Add more</a>
              </div>
            </div>

            <div style="overflow:auto;">
              <table class="table">
                <thead>
                  <tr>
                    <th>Spec</th>
                    ${
                      list.map(tv=>`
                        <th>
                          <div style="display:flex; gap:10px; align-items:center;">
                            <img src="${tv.image}" alt="${tv.name}" style="width:70px;height:50px;object-fit:contain;">
                            <div>
                              <div style="font-weight:900;">${tv.series}</div>
                              <div class="small">${tv.sizeIn}” • ${tv.panel}</div>
                              <div class="small" style="margin-top:6px;">
                                <button class="btn" data-removecmp="${tv.id}" style="padding:8px 10px; border-radius:12px;">Remove</button>
                              </div>
                            </div>
                          </div>
                        </th>
                      `).join("")
                    }
                  </tr>
                </thead>
                <tbody>
                  ${rows.map(([label, fn])=>`
                    <tr>
                      <td><b>${label}</b></td>
                      ${list.map(tv=>`<td>${fn(tv)}</td>`).join("")}
                    </tr>
                  `).join("")}
                  <tr>
                    <td><b>Actions</b></td>
                    ${list.map(tv=>`
                      <td>
                        <button class="btn btn-primary" data-add="${tv.id}">Add to cart</button>
                        <button class="btn" data-fav="${tv.id}">Favorite</button>
                      </td>
                    `).join("")}
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="notice" style="margin-top:12px;">Tip: you can compare up to 3 models.</div>
          </div>

          <div class="footer">Add TVs to compare from <a href="#/products"><b>Shop TVs</b></a>.</div>
        </section>
      `;

      document.getElementById("clearCompareBtn").addEventListener("click", ()=>{
        clearCompare(); toast("Cleared compare list"); location.hash="#/compare";
      });
      app.querySelectorAll("[data-removecmp]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const id=b.dataset.removecmp;
          const s=new Set(getCompare()); s.delete(id); setCompare([...s]);
          toast("Removed from compare"); location.hash="#/compare";
        });
      });
      app.querySelectorAll("[data-add]").forEach(b=>{
        b.addEventListener("click", ()=>{ addToCart(b.dataset.add,1); toast("Added to cart"); });
      });
      app.querySelectorAll("[data-fav]").forEach(b=>{
        b.addEventListener("click", ()=>{ toggleFav(b.dataset.fav); toast("Updated favorites"); });
      });
    }

    function viewCart(){
      badge.textContent = "Cart";

      app.innerHTML = `
        <section class="section">
          <div class="split">
            <div class="card card-pad">
              <div class="section-title">
                <h2>Your cart</h2>
                <div class="sub">Review items</div>
              </div>
              <div id="cartTable"></div>
            </div>
            <div class="card" id="cartSummary"></div>
          </div>
          <div class="footer">Checkout is a dummy flow (no payment gateway).</div>
        </section>
      `;

      const tableWrap = document.getElementById("cartTable");
      const summaryWrap = document.getElementById("cartSummary");

      function render(){
        const t = calcCartTotals();

        if(!t.items.length){
          tableWrap.innerHTML = `
            <div class="notice">
              Your cart is empty. Add TVs from
              <a href="#/products"><b>Shop TVs</b></a>.
            </div>`;
          summaryWrap.innerHTML = `
            <div class="summary">
              <div class="summary-row"><span>Subtotal</span><b>${formatINR(0)}</b></div>
              <div class="summary-row"><span>Total</span><b>${formatINR(0)}</b></div>
              <a class="btn btn-primary" href="#/products"
                 style="display:block;text-align:center;margin-top:12px;">
                Browse TVs
              </a>
            </div>`;
          return;
        }

        tableWrap.innerHTML = `
          <table class="table">
            <thead>
              <tr>
                <th>Item</th>
                <th style="width:120px;">Price</th>
                <th style="width:140px;">Qty</th>
                <th style="width:140px;">Line total</th>
                <th style="width:120px;">Actions</th>
              </tr>
            </thead>
            <tbody>
              ${t.items.map(it=>`
                <tr>
                  <td>
                    <div style="display:flex; gap:12px; align-items:center;">
                      <img src="${it.image}" alt="${it.name}"
                           style="width:90px;height:60px;object-fit:contain;">
                      <div>
                        <b>${it.name}</b>
                        <div class="small">
                          ${it.panel} • ${it.sizeIn}” • ${it.refreshHz}Hz
                        </div>
                      </div>
                    </div>
                  </td>
                  <td>${formatINR(it.price)}</td>
                  <td>
                    <input class="input" type="number" min="1"
                           value="${it.qty}" data-qty="${it.id}"
                           style="min-width:0;width:110px;">
                  </td>
                  <td><b>${formatINR(it.line)}</b></td>
                  <td>
                    <button type="button" class="btn" data-remove="${it.id}">
                      Remove
                    </button>
                  </td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        `;

        summaryWrap.innerHTML = `
          <div class="summary">
            <div class="summary-row"><span>Subtotal</span><b>${formatINR(t.subtotal)}</b></div>
            <div class="summary-row"><span>Shipping</span><b>${formatINR(t.shipping)}</b></div>
            <div class="summary-row"><span>Discount</span><b>- ${formatINR(t.discount)}</b></div>
            <hr class="sep">
            <div class="summary-row"><span><b>Total</b></span><b>${formatINR(t.total)}</b></div>

            <a class="btn btn-primary" href="#/checkout"
               style="display:block;text-align:center;margin-top:12px;">
              Checkout
            </a>
            <button type="button" class="btn btn-ghost"
                    id="clearCartBtn"
                    style="width:100%;margin-top:10px;">
              Clear cart
            </button>

            <div class="notice" style="margin-top:12px;">
              Free shipping above <b>${formatINR(60000)}</b>. Extra 5% discount above <b>${formatINR(120000)}</b>.
            </div>
          </div>
        `;
      }

      // Event delegation
      tableWrap.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-remove]");
        if(!btn) return;
        setQty(btn.dataset.remove, 0);
        toast("Removed item");
        render();
      });

      tableWrap.addEventListener("change", (e) => {
        const inp = e.target.closest("[data-qty]");
        if(!inp) return;
        const qty = Number(inp.value);
        setQty(inp.dataset.qty, qty > 0 ? qty : 1);
        render();
      });

      summaryWrap.addEventListener("click", (e) => {
        if(e.target && e.target.id === "clearCartBtn"){
          clearCart();
          toast("Cart cleared");
          render();
        }
      });

      render();
    }

    function viewCheckout(){
      badge.textContent = "Checkout";
      const t=calcCartTotals();

      app.innerHTML = `
        <section class="section">
          <div class="split">
            <div class="card card-pad">
              <div class="section-title">
                <h2>Delivery + dummy payment</h2>
                <div class="sub">No real gateway</div>
              </div>

              <form id="checkoutForm">
                <div class="field" style="gap:10px;">
                  <input class="input" required name="name" placeholder="Full name">
                  <input class="input" required name="phone" placeholder="Phone">
                </div>
                <div style="height:10px;"></div>
                <input class="input" required name="email" placeholder="Email" style="width:100%;">
                <div style="height:10px;"></div>
                <input class="input" required name="address" placeholder="Address" style="width:100%;">
                <div style="height:10px;"></div>
                <div class="field" style="gap:10px;">
                  <input class="input" required name="city" placeholder="City">
                  <input class="input" required name="pincode" placeholder="PIN code">
                </div>

                <hr class="sep">

                <div class="notice">
                  Dummy card details (UI only):
                  <div style="height:10px;"></div>
                  <div class="field" style="gap:10px;">
                    <input class="input" required name="card" placeholder="Card number (dummy)">
                    <input class="input" required name="exp" placeholder="MM/YY">
                    <input class="input" required name="cvv" placeholder="CVV">
                  </div>
                </div>

                <div class="cta-row" style="margin-top:14px;">
                  <a class="btn" href="#/cart">Back to cart</a>
                  <button class="btn btn-primary" type="submit">Pay (dummy) & Place order</button>
                </div>
              </form>
            </div>

            <div class="card" id="orderSummary"></div>
          </div>

          <div class="footer">After payment you’ll see a confirmation page with a transaction ID.</div>
        </section>
      `;

      const sum=document.getElementById("orderSummary");
      const form=document.getElementById("checkoutForm");

      if(!t.items.length){
        sum.innerHTML = `
          <div class="summary">
            <div class="notice">Your cart is empty. Add items first.</div>
            <a class="btn btn-primary" href="#/products" style="display:block;text-align:center;margin-top:12px;">Shop TVs</a>
          </div>
        `;
        form.style.display="none";
        return;
      }

      sum.innerHTML = `
        <div class="summary">
          <div class="section-title" style="margin:0 0 10px;">
            <h2>Order summary</h2>
            <div class="sub">${t.items.length} item(s)</div>
          </div>

          ${t.items.map(it=>`
            <div class="summary-row"><span>${it.series} ${it.sizeIn}” × ${it.qty}</span><b>${formatINR(it.line)}</b></div>
          `).join("")}

          <hr class="sep">
          <div class="summary-row"><span>Subtotal</span><b>${formatINR(t.subtotal)}</b></div>
          <div class="summary-row"><span>Shipping</span><b>${formatINR(t.shipping)}</b></div>
          <div class="summary-row"><span>Discount</span><b>- ${formatINR(t.discount)}</b></div>
          <hr class="sep">
          <div class="summary-row"><span><b>Total</b></span><b>${formatINR(t.total)}</b></div>
        </div>
      `;

      form.addEventListener("submit", (e)=>{
        e.preventDefault();
        const fd=new FormData(form);
        const customer=Object.fromEntries(fd.entries());
        const order=placeOrder(customer);
        if(!order){ alert("Cart is empty."); return; }
        toast("Payment successful (dummy)");
        location.hash="#/confirmation";
      });
    }

    function viewConfirmation(){
      badge.textContent = "Confirmation";
      const order=getLastOrder();
      if(!order){
        app.innerHTML = `
          <section class="section">
            <div class="card card-pad glow">
              <h1 style="margin:0 0 10px;">No recent order found</h1>
              <p style="margin:0 0 14px; color: rgba(238,240,255,.72);">
                Place an order from checkout to see confirmation details.
              </p>
              <div class="cta-row">
                <a class="btn btn-primary" href="#/products">Shop TVs</a>
                <a class="btn" href="#/cart">View cart</a>
              </div>
            </div>
            <div class="footer">This is a demo confirmation page. No real payment is processed.</div>
          </section>
        `;
        return;
      }

      const dt=new Date(order.createdAt);
      app.innerHTML = `
        <section class="section">
          <div class="card card-pad glow">
            <h1 style="margin:0 0 10px;">Order confirmed ✅</h1>
            <p style="margin:0 0 14px; color: rgba(238,240,255,.72);">
              Thanks, <b>${order.customer?.name || "customer"}</b>. Your GRetail order is locked in.
            </p>

            <div class="kpis">
              <div class="kpi"><b>Order ID</b><span>${order.orderId}</span></div>
              <div class="kpi"><b>Transaction ID</b><span>${order.txId}</span></div>
              <div class="kpi"><b>Placed</b><span>${dt.toLocaleString()}</span></div>
              <div class="kpi"><b>Total paid</b><span><b>${formatINR(order.total)}</b></span></div>
            </div>

            <hr class="sep">

            <div class="section-title">
              <h2>Order details</h2>
              <div class="sub">${order.items.length} item(s)</div>
            </div>

            <table class="table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th style="width:120px;">Price</th>
                  <th style="width:80px;">Qty</th>
                  <th style="width:140px;">Line total</th>
                </tr>
              </thead>
              <tbody>
                ${order.items.map(it=>`
                  <tr>
                    <td>
                      <div style="display:flex; gap:12px; align-items:center;">
                        <img src="${it.image}" alt="${it.name}" style="width:90px;height:60px;object-fit:contain;">
                        <div>
                          <b>${it.name}</b>
                          <div class="small">ID: ${it.id}</div>
                        </div>
                      </div>
                    </td>
                    <td>${formatINR(it.price)}</td>
                    <td>${it.qty}</td>
                    <td><b>${formatINR(it.line)}</b></td>
                  </tr>
                `).join("")}
              </tbody>
            </table>

            <div class="card" style="margin-top:12px;">
              <div class="summary">
                <div class="summary-row"><span>Subtotal</span><b>${formatINR(order.subtotal)}</b></div>
                <div class="summary-row"><span>Shipping</span><b>${formatINR(order.shipping)}</b></div>
                <div class="summary-row"><span>Discount</span><b>- ${formatINR(order.discount)}</b></div>
                <hr class="sep">
                <div class="summary-row"><span><b>Total</b></span><b>${formatINR(order.total)}</b></div>
              </div>
            </div>

            <hr class="sep">

            <div class="notice">
              Delivery to: <b>${order.customer?.address || ""}</b>, ${order.customer?.city || ""} - ${order.customer?.pincode || ""}<br>
              Contact: ${order.customer?.phone || ""} • ${order.customer?.email || ""}
            </div>

            <div class="cta-row" style="margin-top:14px;">
              <a class="btn btn-primary" href="#/products">Continue shopping</a>
              <a class="btn" href="#/">Home</a>
            </div>
          </div>

          <div class="footer">This is a demo confirmation page. No real payment is processed.</div>
        </section>
      `;
    }

    // ========= Router =========
    function route(){
      updateBadges();
      const h=(location.hash||"#/").replace("#","");
      const path=h.startsWith("/")?h:"/"+h;

      if(path==="/" ) viewHome();
      else if(path==="/products") viewProducts();
      else if(path==="/compare") viewCompare();
      else if(path==="/favorites") viewFavorites();
      else if(path==="/cart") viewCart();
      else if(path==="/checkout") viewCheckout();
      else if(path==="/confirmation") viewConfirmation();
      else location.hash="#/";
    }

    window.addEventListener("hashchange", route);
    updateBadges();
    if(!location.hash) location.hash="#/";
    route();
  </script>
</body>
</html>
